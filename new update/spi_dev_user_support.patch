From f78f71adc4bb8201b8ef23d9f234fb4f74b2f763 Mon Sep 17 00:00:00 2001
From: Mathanraj <mathan.raj@seco.com>
Date: Mon, 16 Jan 2017 15:57:21 +0530
Subject: [PATCH] Added spidev user space support

---
 arch/arm/boot/dts/imx6qdl-seco_uq7_962.dtsi | 17 ++++++++++-------
 drivers/spi/spidev.c                        |  4 +++-
 2 files changed, 13 insertions(+), 8 deletions(-)
 mode change 100644 => 100755 drivers/spi/spidev.c

diff --git a/arch/arm/boot/dts/imx6qdl-seco_uq7_962.dtsi b/arch/arm/boot/dts/imx6qdl-seco_uq7_962.dtsi
index 71445b1..ff09e9c 100755
--- a/arch/arm/boot/dts/imx6qdl-seco_uq7_962.dtsi
+++ b/arch/arm/boot/dts/imx6qdl-seco_uq7_962.dtsi
@@ -322,7 +322,7 @@
 				/*  USB  */
 				MX6QDL_PAD_EIM_D22__GPIO3_IO22               0x1f071
 				MX6QDL_PAD_GPIO_17__GPIO7_IO12               0x1f071
-				/*  ECTRL INTERRUPT  */
+				/*  ECTRL INTERRrtcUPT  */
 				MX6QDL_PAD_NANDF_D7__GPIO2_IO07              0x1f071
 				/*  PWR EMBEDDED CONTROLLER  */
 				MX6QDL_PAD_NANDF_D4__GPIO2_IO04              0x1f071
@@ -599,7 +599,7 @@
 &can1 {
 	pinctrl-names = "default";
 	pinctrl-0     = <&pinctrl_flexcan1>;
-	status        = "disable";
+	status        = "okay";
 };
 /*  __________________________________________________________________________
  * |__________________________________________________________________________|
@@ -688,8 +688,12 @@
 	cs-gpios                = <&gpio5 12  0>, <&gpio5 9 0>;
 	pinctrl-names           = "default";
 	pinctrl-0               = <&pinctrl_ecspi2>;
-	status                  = "okay";
-
+	status                  = "okay";	
+	spidev@0x00{
+	compatible = "spidev";
+	spi-max-frequency = <1000000>;
+	reg = <0>;
+	}; 
 };
 
 
@@ -699,9 +703,8 @@
 	pinctrl-names           = "default";
 	pinctrl-0               = <&pinctrl_ecspi3>;
 	status                  = "okay";
-	
 	rtc: pcf2123@1 {
-                compatible        = "nxp,pcf2123";
+                compatible        = "nxp,rtc-pcf2123";
                 reg               = <1>;
                 spi-max-frequency = <1000000>;
                 spi-cs-high;
@@ -785,7 +788,7 @@
 		clocks       = <&clks IMX6QDL_CLK_CKO>;
 		VDDA-supply  = <&reg_2p5v_sgtl5000>;
 		VDDIO-supply = <&reg_3p3v_sgtl5000>;
-		status       = "disabled";
+		status       = "okay";
 	};
 
 };
diff --git a/drivers/spi/spidev.c b/drivers/spi/spidev.c
old mode 100644
new mode 100755
index 8fab566..6f59d16
--- a/drivers/spi/spidev.c
+++ b/drivers/spi/spidev.c
@@ -707,11 +707,13 @@ static struct class *spidev_class;
 #ifdef CONFIG_OF
 static const struct of_device_id spidev_dt_ids[] = {
 	{ .compatible = "rohm,dh2228fv" },
+	{ .compatible = "spidev" },
 	{},
 };
 MODULE_DEVICE_TABLE(of, spidev_dt_ids);
 #endif
 
+
 /*-------------------------------------------------------------------------*/
 
 static int spidev_probe(struct spi_device *spi)
@@ -728,7 +730,7 @@ static int spidev_probe(struct spi_device *spi)
 	if (spi->dev.of_node && !of_match_device(spidev_dt_ids, &spi->dev)) {
 		dev_err(&spi->dev, "buggy DT: spidev listed directly in DT\n");
 		WARN_ON(spi->dev.of_node &&
-			!of_match_device(spidev_dt_ids, &spi->dev));
+			!of_match_device(spidev_dt_ids, &spi->dev));		
 	}
 
 	/* Allocate driver data */
-- 
2.0.4

